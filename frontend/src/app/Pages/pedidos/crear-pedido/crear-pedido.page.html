<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/"></ion-back-button>
    </ion-buttons>
    <ion-title>Crear Pedido</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- Filtro por nombre -->
  <ion-item>
    <ion-label position="floating">Buscar producto por nombre</ion-label>
    <ion-input
      type="text"
      [(ngModel)]="terminoBusqueda"
      (ionInput)="filtrarProductos()"
      required
    ></ion-input>
  </ion-item>

  <!-- Lista de productos filtrados (selección) -->
  <div class="lista-filtrada" *ngIf="productosFiltrados.length > 0">
    <ion-list>
      <ion-item *ngFor="let producto of productosFiltrados">
        <ion-thumbnail slot="start">
          <img [src]="producto.imagenUrl || 'assets/logo.png'" />
        </ion-thumbnail>

        <ion-label>
          <h3>{{ producto.nombre }}</h3>
          <p>Precio: ${{ producto.precio }}</p>
        </ion-label>

        <ion-input
          type="number"
          placeholder="Cantidad"
          [(ngModel)]="producto.cantidad"
          min="0"
          (ionInput)="actualizarSeleccion(producto)"
          required
        ></ion-input>
      </ion-item>
    </ion-list>
  </div>

  <!-- Productos seleccionados (solo vista, sin edición) -->
  <div class="lista-seleccionados" *ngIf="productosSeleccionados.length > 0">
    <h4>Productos Seleccionados</h4>
    <ion-list>
      <ion-item *ngFor="let producto of productosSeleccionados">
        <ion-thumbnail slot="start">
          <img [src]="producto.imagenUrl || 'assets/logo.png'" />
        </ion-thumbnail>

        <ion-label>
          <h3>{{ producto.nombre }}</h3>
          <p>Precio: ${{ producto.precio }}</p>
          <p>Cantidad: {{ producto.cantidad }}</p>
          <p>Subtotal: ${{ producto.precio * producto.cantidad }}</p>
        </ion-label>
      </ion-item>
    </ion-list>
  </div>

  <ion-item>
    <ion-label position="floating">Fecha de entrega</ion-label>
    <ion-datetime
      [(ngModel)]="fechaEntrega"
      presentation="date"
      [min]="hoy"
      required
    ></ion-datetime>
  </ion-item>

  <ion-item>
    <ion-label position="floating">Notas adicionales</ion-label>
    <ion-textarea [(ngModel)]="notas" required></ion-textarea>
  </ion-item>

  <ion-button expand="block" (click)="crearPedido()" [disabled]="!puedeEnviar()">
    Confirmar Pedido
  </ion-button>
</ion-content>
